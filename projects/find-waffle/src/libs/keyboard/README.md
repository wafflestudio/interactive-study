# KeyMap Library User Guide

## Introduction

KeyMap 라이브러리는 단축키를 관리하기 위해 만들어졌습니다. 브라우저에서 키보드 이벤트를 다루기 위해 사용되는 가장 원시적인 형태는 이벤트 리스너에 키보드 이벤트를 주시하는 콜백을 등록하는 것입니다. 하지만 이 방법은 단축키를 관리하기에 적절하지 않습니다. 키보드 이벤트에 대한 이벤트 리스너를 등록할 때에는 `keydown`, `keyup` 과 같이 매우 단순한 형태의 이벤트 타입만 구독할 수 있기 때문에, 원하는 단축키가 눌려있는지에 대한 로직을 콜백 내부에 작성해야하는 문제가 있습니다. 본 라이브러리를 사용하면 얻는 장점은 다음과 같습니다.

1. 특정 단축키가 눌렸을 때 실행되는 콜백을 매우 직관적으로 등록할 수 있습니다.
2. OS 종류와 입력 언어와 무관하게 간단한 규칙으로 보편적인 단축키를 작성할 수 있습니다.
3. 현재 눌려있는 키를 실시간으로 관찰할 수 있습니다.

## How to use

### KeyMap 생성하기

여러분만의 고유한 키맵을 작성하기 위해서 맨 처음 해야하는 것은 `KeyMap` 클래스의 인스턴스를 만들어야 합니다.

```ts
const keymap = new KeyMap();
```

### 단축키 등록하기

단축키를 등록하기 위해, 그저 원하는 단축키와 해당 단축키가 눌리거나 떼졌을 때 실행할 콜백을 앞서 만든 `keymap` 객체의 `bind` 메서드의 인자로 넘기기만 하면 됩니다. 단축키는 매우 직관적인 문자열로 구성되어 있습니다. 예를 들어, `ctrl + shift + z` 단축키를 등록하고 싶다면 다음과 같이 작성하면 됩니다.

```ts
keymap.bind(
  'ctrl + shift + z',
  () => {
    // 단축키가 눌렸을 때 실행할 로직
  },
  () => {
    // 단축키가 떼졌을 때 실행할 로직
  },
  {
    preventDefault: true, // 기본 이벤트를 막을지 여부
    allowRepeated: false, // 반복 이벤트를 허용할지 여부
  }
);
```

단축키 문자열은 수식키 (ctrl, shift 등) 와 트리거키로 구성되어 있습니다. 수식키는 없어도 되고 여러 개일 수도 있지만, 트리거키는 반드시 하나이고, 단축키의 마지막에 와야합니다. 수식키로 쓰이는 ctrl, shift 등도 트리거키가 될 수 있습니다. 하지만 키보드에는 항상 수식키가 좌우쌍으로 존재하므로 이 경우에는 어떤 키를 의미하는지 명확하게 해야합니다.

```ts
'ctrl'; // 불가능. 좌우 방향을 명시하지 않은 수식키는 트리거키로 사용될 수 없고, 트리거키는 반드시 하나여야함.
'ctrl + z + shift'; // 불가능. 트리거키는 반드시 마지막에 와야함.
'ctrl + a + z'; // 불가능. 트리거키는 반드시 하나여야함.
'leftctrl'; // 가능.
'z'; // 가능.
'ctrl + shift + z'; // 가능.
```

트리거키로 사용될 수 있는 키들은 알파벳, 상단 숫자, 펑션키, 특수문자 이렇게 4가지 입니다. 이 중 알파벳과 상단 숫자, 펑션키는 명확하지만 특수문자는 어떻게 입력해야하는지 모호하게 느껴질 수 있습니다. 트리거키로 사용가능한 트리거키와 작성 방법에 대해서는 부록에 후술되어 있습니다.

### 단축키 해제하기

단축키를 해제하기 위해서는 `keymap` 객체의 `unbind` 메서드를 사용하면 됩니다. `bind` 메서드와 동일한 단축키 문자열을 인자로 넘기면 됩니다.

```ts
keymap.unbind('ctrl + shift + z');
```

### 키맵 활성화/비활성화하기

`activate`, `deactivate` 키맵을 활성화하거나 비활성화할 수 있습니다. `keymap` 객체가 만들어진 직후에는 활성화되지 않은 상태이므로 꼭 사용하기 전에 명시적으로 활성화해야하고, 더 이상 사용하고 싶지 않다면 비활성화해야합니다. 하지만 키맵은 항상 한 번에 하나만 활성화될 수 있으므로, 다른 키맵을 활성화하면 이전에 활성화된 키맵은 자동으로 비활성화됩니다.

```ts
keymap1.activate(); // keymap1 활성화
keymap2.activate(); // keymap1 비활성화, keymap2 활성화
keymap2.deactivate(); // keymap2 비활성화
```

## 부록 1. 특수문자 트리거키 테이블

| 특수문자      | 트리거키                                             |
| ------------- | ---------------------------------------------------- |
| 왼쪽 Shift    | - LeftShift <br/> - ShiftLeft                        |
| 오른쪽 Shift  | - RightShift <br/> - ShiftRight                      |
| 왼쪽 Ctrl     | - LeftCtrl <br/> - CtrlLeft                          |
| 오른쪽 Ctrl   | - RightCtrl <br/> - CtrlRight                        |
| 왼쪽 Alt      | - LeftAlt <br/> - AltLeft                            |
| 오른쪽 Alt    | - RightAlt <br/> - AltRight                          |
| 왼쪽 Meta     | - LeftMeta <br/> - MetaLeft                          |
| 오른쪽 Meta   | - RightMeta <br/> - MetaRight                        |
| Caps Lock     | - CapsLock                                           |
| 스페이스바    | - Space                                              |
| 엔터          | - Enter                                              |
| 탭            | - Tab                                                |
| 백스페이스    | - Backspace                                          |
| ESC           | - Escape <br/> - Esc                                 |
| 왼쪽 화살표   | - LeftArrow <br/> - ArrowLeft <br/> - <- <br/> - ←   |
| 오른쪽 화살표 | - RightArrow <br/> - ArrowRight <br/> - -> <br/> - → |
| 위쪽 화살표   | - UpArrow <br/> - ArrowUp <br/> - ↑                  |
| 아래쪽 화살표 | - DownArrow <br/> - ArrowDown <br/> - ↓              |
| 백쿼트        | - Backquote <br/> - `                                |
| 마이너스      | - Minus <br/> - -                                    |
| 이퀄          | - Equal <br/> - =                                    |
| 왼쪽 대괄호   | - LeftBracket <br/> - BracketLeft <br/> - [          |
| 오른쪽 대괄호 | - RightBracket <br/> - BracketRight <br/> - ]        |
| 역슬래시      | - Backslash <br/> - \                                |
| 세미콜론      | - Semicolon <br/> - ;                                |
| 작은 따옴표   | - Quote <br/> - '                                    |
| 콤마          | - Comma <br/> - ,                                    |
| 점            | - Period <br/> - .                                   |
| 슬래시        | - Slash <br/> - /                                    |

## 부록 2. 빠지기 쉬운 함정

### 반복 이벤트를 오남용하지 말자.
스페이스바를 누르고 있으면 총알을 연사하는 기능을 구현하고 싶다고 합시다. 바인딩 옵션에서 `allowRepeated` 를 켜고 매 이벤트마다 총알을 발사하는 콜백을 등록하면 될 것 같습니다. 하지만 여기에는 몇 가지 함정이 존재합니다. 첫째, 키보드의 반복 속도는 OS 설정에 따라 다르기 때문에, 총알의 발사 속도가 사용자마다 다르게 됩니다. 둘째, 대부분의 OS에서는 마지막으로 눌린 키에만 반복이벤트를 발생시키기 때문에 총알을 발사하는 도중 캐릭터를 움직이기 위해 화살표 키를 누르면 총알의 발사가 중단됩니다. 셋째, 키보드 이벤트의 반복은 누른 순간부터 시작하는 게 아니라 일정 시간이 지난 후에 시작되기 때문에, 총알의 연사가 시작되는 시점까지 딜레이가 생깁니다. 이러한 문제를 해결하기 위해서는 `setInterval` 이나 `requestAnimationFrame` 을 사용하여 총알을 발사하는 콜백을 주기적으로 호출하는 것이 좋습니다.
